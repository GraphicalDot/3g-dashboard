{% extends "admin/base.html" %}
{% load i18n static %}
{% block extrastyle %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.1.0/jquery-confirm.min.css">
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.1.0/jquery-confirm.min.js"></script>
{% endblock %}
{% block title %}{{ title }} | 3G Admin-Dash Board {% endblock %}
{% block branding %}
<h1 id="site-name"><a href="{% url 'admin:index' %}">3G Admin Dash Board</a></h1>
{% endblock %}

{% block nav-global %}{% endblock %}
{% block footer %}
<div id="footer">
<script>
    function filter_field(data, field_name, child_names){
        console.log(data);
        data['field_name'] = field_name;
        $.post( "/filter/fields/", data, function( data ) {
            $("#id_"+child_names).html(data[0]['option_data']);
            $("#id_hidden_"+child_names).val(data[0]['hidden_field_value']);
        });
    }

    function collect_data(){
        data = {}
        data['csrfmiddlewaretoken'] = '{{ csrf_token }}';
        data['model_name'] = '{{ opts.model_name }}';
        data['country'] = $('#id_country').val();
        data['board'] = $('#id_select_board').val();
        data['grade'] = $('#id_grade').val();
        data['state'] = $('#id_select_state').val();
        data['stream'] = $('#id_stream').val();
        data['subject'] = $('#id_subject').val();

        return data;
    }

    $('#id_country').change(function(){
        filter_field(collect_data(), 'country', 'select_state');
    });

    $('#id_select_state').change(function(){
        filter_field(collect_data(), 'state', 'select_board');
    });

    $('#id_select_board').change(function(){
        filter_field(collect_data(), 'board', 'select_grade');
    });

    $('#id_select_grade').change(function(){
        filter_field(collect_data(), 'stream', 'stream');
    });

    $('#id_stream').change(function(){
        filter_field(collect_data(), 'stream', 'subject');
    });

    $('#id_subject').change(function(){
        filter_field(collect_data(), 'subject', 'chapter');
    });

    //$('#id_chapter').change(function(){
    //    console.log('Country Change ...');
    //});

    if("{{ opts.model_name }}" == "classcategory"){
        $('#top_form_msg').html("<li style='color:blue;'>Select grade or enter in title for new or both.</li>");
        // Add a msg on top of form.
    }

</script>
</div>
{% endblock %}