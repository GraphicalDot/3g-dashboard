{% extends 'home.html' %}
{% block extend_head %}
<script>
        
        var course_permission = [{'id': "46", "course": "course1",
            "subjects": [{"id": "47", "subject_name": "subject1",
                        "chapter": [{"id": "48", "chapter_name": "chapter1",
                        "topic": [{"id": "49", "topic_name": "topic1",
                        "module": [{"id": "100", "module_name": "module1"}]}]}]}]},
            {"id": "50", "course": "course2",
                        "subjects": [{"id": "51", "subject_name": "subject2",
                        "chapter": [{"id": "52", "chapter_name": "chapter2",
                        "topic": [{"id": "53", "topic_name": "topic2",
                        "module": [{"id": "54", "module_name": "module2",}]}]}]}]}]
        
        var filtered_permissions;

        function filterSubjects(courseChoice){
            var data_id = courseChoice.value;
            var permission_name = courseChoice.id;
            for(i in course_permission){
                if(course_permission[i].id == data_id){
                    filtered_permissions = course_permission[i].subjects;
                }
            }
            console.log(filtered_permissions);

            var subjects = "<option value="+data_id+">"+courseChoice.id+"</option>";
            $('#subject_permission').append(subjects);

            $(document).ready(function() {
            $('select').material_select();
        });
        }

        function filterChapters(subjectChoice){
            var data_id = subjectChoice.value;
            console.log(data_id);
            console.log(filtered_permissions);
            for(var i=0; i < filtered_permissions.length; i++){
                if(filtered_permissions[i]["id"] === data_id){
                    filtered_permissions = filtered_permissions[i].chapter;
                    console.log(filtered_permissions);
                }
            }
            var subjects = "<option value="+data_id+">"+subjectChoice.id+"</option>";
            $('#chapter_permission').append(subjects);
            $(document).ready(function() {
            $('select').material_select();
        });
        }

        function filterTopics(chapterChoice){
            var data_id = chapterChoice.value;
            console.log(data_id);
            for(var i=0; i < filtered_permissions.length; i++){
                if(filtered_permissions[i]["id"] === data_id){
                    filtered_permissions = filtered_permissions[i].topic;
                    console.log(filtered_permissions);
                }
            }
            var subjects = "<option value="+data_id+">"+chapterChoice.id+"</option>";
            $('#topic_permission').append(subjects);

            $(document).ready(function() {
            $('select').material_select();
        });
        }

        function filterModules(topicChoice){
            $('#'+data_id).click(function(){

            });
            var data_id = topicChoice.value;
            console.log(data_id);
            for(var i=0; i < filtered_permissions.length; i++){
                if(filtered_permissions[i]["id"] === data_id){
                    filtered_permissions = filtered_permissions[i].module;
                    console.log(filtered_permissions);
                }
            }
            var subjects = "<option value="+data_id+">"+topicChoice.id+"</option>";
            $('#module_permission').append(subjects);

            $(document).ready(function() {
            $('select').material_select();
        });
        }

        
        $(document).ready(function() {
            $('select').material_select();
        });
        
        $('.datepicker').pickadate({
            selectMonths: true,
            selectYears: 15
        });
        
        $('#add_choice').click(function(){
            var choice = "<br/><div class='row' id='div "+counter+" '><div class='col-sm-4'>Choice: "+counter+" <input type='text' placeholder='Choice "+counter+"' name='choice' id='choice"+counter+"' /></div><div class='col-sm-8'><input type='file' name='get_image' id='imgInp"+ counter+"' onchange='readURL(this);' multiple/><br /><img id='blah"+counter+"' style='display:none' alt='your image' /></div></div>"
            $('#form-test').append(choice)
            return true;

   });

    </script>
{% endblock %}

{% block body%}
<!--<div class="container">-->
    <h1>Assign Task</h1>
    <div class="row">
        <form class="col s8" method="post">
            {% csrf_token %}
            <div class="row">
                <div>
                    <label>Course</label>
                    <select name="course_permission" id="course_permission" onchange="filterSubjects(this)">
                    <!--<select name="course_permission" id="course_permission" onmousedown="this.value" onchange="test()">-->
                        <option value="" disabled selected>Select Course</option>
                        {% for course in permissions.course_permissions %}
                        <option value="{{ course.id }}">{{ course.codename }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label>Subject</label>
                    <select name="subject_permission" id="subject_permission" onchange="filterChapters(this)">
                        <option value="">Select Subject</option>
                        {% for subject in permissions.subject_permissions %}
                        <option value="{{ subject.id }}">{{ subject.codename }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label>Chapter</label>
                    <select name="chapter_permission" id="chapter_permission" onchange="filterTopics(this)">
                        <option value="">Select Chapter</option>
                        {% for chapter in permissions.chapter_permissions %}
                        <option value="{{ chapter.id }}">{{ chapter.codename }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label>Topic</label>
                    <select name="topic_permission" id="topic_permission" onchange="filterModules(this)">
                        <option value="" disabled selected>Select Topic</option>
                        {% for topic in permissions.topic_permissions %}
                        <option value="{{ topic.id }}">{{ topic.codename }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label>Module</label>
                    <select name="module_permission" id="module_permission" multiple>
                        <option value="" disabled selected>Select module</option>
                        {% for module in permissions.module_permissions %}
                        <option value="{{ module.code }}">{{ module.codename }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="row">
                <span style="color: red">{{ form.errors.title }}</span>
                <div class="input-field col s6">

                    <input id="title" type="text" data-length="50" name="title" maxlength="50" value="{{ form.title.value }}">
                    <label for="title">Title</label>
                </div>
            </div>
            <div class="row">
                <span style="color: red">{{ form.errors.title }}</span>
                <div class="input-field col s12">
                    <input id="description" type="text" class="validate" name="description" value="{{ form.description.value }}">
                    <label for="description">Task Description</label>
                </div>
            </div>

            <div class="row">
                <span style="color: red">{{ form.errors.title }}</span>
                <label>Select due date</label>
                <input type="date" class="datepicker" name="due_date" value="{{ form.due_date.value }}">
            </div>

            <div class='row'>
                <button type='submit' class='col s12 btn btn-large waves-effect indigo'>Submit Task</button>
              </div>
        </form>
    </div>
    <!--</div>-->
{% endblock %}
